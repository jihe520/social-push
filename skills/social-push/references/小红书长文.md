
## 上传长文 workflow

1. 打开发布图文的网站：`agent-browser --state ~/my-state.json --headed open "https://creator.xiaohongshu.com/publish/publish?source=official&from=tab_switch&target=article"`
2. 查看交互：`agent-browser snapshot -i`
3. 进入长文：`agent-browser click @e1`
4. 插入标题：`agent-browser fill @e11 "{标题}"`
5. 将要上传文件内容保存到剪切板：`cat "{文件路径}" | pbcopy`
6. 点击正文编辑框：`agent-browser click ".ProseMirror"`
7. 将剪切板内容粘贴到正文：`agent-browser press "Meta+v"`
8. 替换 Markdown 图片引用

--

8. 一键排版：`agent-browser click @e13`
2. 查看交互：`agent-browser snapshot -i`
9. 下一步：`agent-browser click @e15`
2. 查看交互：`agent-browser snapshot -i`
10. 在描述框输入简介：`agent-browser type ".ProseMirror" "{简介内容}"`
11. 添加话题：`agent-browser type ".ProseMirror" " #{话题}"`，然后 `agent-browser press "Enter"` 确认
12. 暂存草稿离开：`agent-browser click @e13`

## 元素参考

### 编辑页面（点击"新的创作"后）

| 元素 | 选择器 | 功能 |
|------|--------|------|
| 标题框 | `@e11` | 输入标题 |
| 正文框 | `.ProseMirror` | 输入正文内容 |
| 上传图片 | `@e9` | 工具栏第9个按钮 |
| 一键排版 | `@e13` | 格式化文章 |
| 暂存离开 | `@e14` | 保存草稿 |

### 发布设置页面（点击"下一步"后）

| 元素 | 功能 |
|------|------|
| @e2 | 描述/简介输入框 |
| @e3 | 话题按钮 |
| @e13 | 暂存离开 |
| @e14 | 发布按钮（禁止自动点击） |


## 图片上传

### 方法一：直接粘贴图片

```bash
# 1. 将图片复制到剪贴板（macOS）
osascript -e 'set the clipboard to (read (POSIX file "{图片绝对路径}") as «class PNGf»)'

# 2. 点击正文编辑框
agent-browser click ".ProseMirror"

# 3. 粘贴图片
agent-browser press "Meta+v"
```

### 方法二：替换 Markdown 图片引用

粘贴 Markdown 文本后，将 `![alt](path)` 替换为真实图片：

```bash
# 1. 找到包含图片引用的段落并选中
agent-browser eval "
const ps = document.querySelectorAll('.ProseMirror p');
for (let i = 0; i < ps.length; i++) {
  if (ps[i].innerText.startsWith('![')) {
    const range = document.createRange();
    range.selectNodeContents(ps[i]);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
    break;
  }
}
"

# 2. 删除选中的图片引用文本
agent-browser press "Backspace"

# 3. 将真实图片复制到剪贴板并粘贴
osascript -e 'set the clipboard to (read (POSIX file "{图片路径}") as «class PNGf»)'
agent-browser press "Meta+v"
```

重复以上步骤处理所有图片引用。
